@model IEnumerable<DoctorAppointment.Models.Doctor>

@{
    ViewBag.Title = "Doctor's List";
}

<h2 class="text-center mb-4">Doctor's List</h2>

<!-- 🔍 Filter Section -->
<div class="container mb-4 text-center">
    <label for="departmentFilter" class="form-label fw-bold">Filter by Department:</label>
    <select id="departmentFilter" class="form-select w-auto d-inline-block">
        <option value="all">-- All Departments --</option>
        @foreach (var dept in Model.Select(d => d.Department).Distinct())
        {
            <option value="@dept.Name">@dept.Name</option>
        }
    </select>

    <label for="dateFilter" class="form-label fw-bold me-2">Filter by Date:</label>
    <input type="date" id="dateFilter" class="form-control w-auto d-inline-block" />

</div>

<!-- Doctor Cards -->
<div id="doctorList" class="d-flex flex-wrap justify-content-center gap-4">
    @foreach (var item in Model)
    {


        var availableDays = string.Join(",", item.DoctorSchedules.Select(s => s.DayOfWeek.ToString()));




        <div class="card shadow-lg doctor-card"
             data-department="@item.Department.Name"
             data-days="@availableDays"
             style="width: 18rem; border-radius: 15px;">
            @if (!string.IsNullOrEmpty(item.Picture))
            {
                <img src="@Url.Content(item.Picture)"
                     class="card-img-top"
                     style="height: 220px; object-fit: cover; border-top-left-radius: 15px; border-top-right-radius: 15px;" />
            }
            else
            {
                <img src="~/images/no-image.png"
                     class="card-img-top"
                     style="height: 220px; object-fit: cover;" />
            }

            <div class="card-body text-center">
                <h5 class="card-title">@item.Name</h5>
                <p class="card-text text-muted mb-1"><strong>Dept:</strong> @item.Department.Name</p>
                <p class="card-text text-muted mb-1"><strong>Org:</strong> @item.Organization.Name</p>
                <p class="card-text text-muted mb-1"><strong>Specialization:</strong> @item.Specialization</p>
                <p class="card-text mb-2"><strong>Fee:</strong> @item.Fee</p>
                <p class="card-text"><strong>Email:</strong> @item.Email</p>
                <p class="card-text"><strong>Phone:</strong> @item.Phone</p>

                <div class="d-grid gap-2 mt-3">
                    <a href="@Url.Action("SelectDoctorFromList", "Appointment", new {
                        OrganizationId = item.OrganizationId,
                        DepartmentId = item.DepartmentId,
                        DoctorId = item.DoctorId
                    })"
                       class="btn btn-primary">
                        Book Appointment
                    </a>
                </div>
            </div>
        </div>
    }
</div>

<style>
    .d-flex.flex-wrap {
        overflow-y: auto;
        max-height: 80vh;
        padding: 10px;
    }

    .card {
        transition: transform 0.2s, box-shadow 0.2s;
    }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
</style>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script>
        $(document).ready(function () {

            function filterDoctors() {
                var selectedDept = $('#departmentFilter').val().toLowerCase();
                var selectedDate = $('#dateFilter').val();

                // Get the weekday name from the selected date (e.g., "Monday")
                var selectedDay = '';
                if (selectedDate) {
                    var dateObj = new Date(selectedDate);
                    selectedDay = dateObj.toLocaleDateString('en-US', { weekday: 'long' });
                }

                $('.doctor-card').each(function () {
                    var cardDept = $(this).data('department').toLowerCase();
                    var availableDays = $(this).data('days'); // e.g. "Monday,Wednesday,Friday"

                    var matchesDept = (selectedDept === 'all' || cardDept === selectedDept);
                    var matchesDate = (!selectedDate || availableDays.includes(selectedDay));

                    if (matchesDept && matchesDate) {
                        $(this).show();
                    } else {
                        $(this).hide();
                    }
                });
            }

            $('#departmentFilter, #dateFilter').on('change', filterDoctors);
        });
    </script>
}

