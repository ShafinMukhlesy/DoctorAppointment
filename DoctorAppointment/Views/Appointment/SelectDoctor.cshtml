@{
    ViewBag.Title = "Book Appointment - Step 1";
}

<div class="container mt-4">
    <div class="card shadow-lg border-0">
        <div class="card-header bg-primary text-white text-center">
            <h3 class="mb-0">Book Appointment </h3>
        </div>
        <div class="card-body">
            @using (Html.BeginForm())
            {
                <div class="row">
                    <!-- Doctor Info Card on Left -->
                    <div class="col-md-4 mb-3">
                        <div id="doctorDetails" class="card shadow-sm border-0" >
                            <div class="card-body text-center">
                                <img id="docImage" src="~/Uploads/Doctors/doctor.png" alt="Doctor Image"
                                     class="img-fluid rounded-circle mb-3 shadow"
                                     style="width:200px; height:200px; object-fit:cover;" />
                                <h4 id="docName" class="mb-1 text-primary"></h4>
                                <p id="docSpec" class="text-muted small"></p>
                                <hr />
                                <p><strong>Fee:</strong> <span id="docFee"></span></p>
                                <p><strong>Email:</strong> <span id="docEmail"></span></p>
                                <p><strong>Phone:</strong> <span id="docPhone"></span></p>
                            </div>
                        </div>
                    </div>

                    <!-- Form on Right -->
                    <div class="col-md-8">
                        <div class="card shadow-sm border-0">
                            <div class="card-body">
                                <h5 class="mb-3 text-secondary">Select Organization & Doctor</h5>

                                <div class="form-group mb-3">
                                    @Html.Label("Organization", new { @class = "form-label fw-bold" })
                                    @Html.DropDownList("OrganizationId", (SelectList)ViewBag.Organizations, "-- Select Organization --", new { @class = "form-control" })
                                </div>

                                <div class="form-group mb-3">
                                    @Html.Label("Department", new { @class = "form-label fw-bold" })
                                    <select id="DepartmentId" name="DepartmentId" class="form-control">
                                        <option>-- Select Department --</option>
                                    </select>
                                </div>

                                <div class="form-group mb-3">
                                    @Html.Label("Doctor", new { @class = "form-label fw-bold" })
                                    <select id="DoctorId" name="DoctorId" class="form-control">
                                        <option>-- Select Doctor --</option>
                                    </select>
                                </div>

                                <div class="form-group mb-4">
                                    @Html.Label("Appointment Date", new { @class = "form-label fw-bold" })
                                    <input type="date" name="AppointmentDate" class="form-control" />
                                </div>

                                <button type="submit" class="btn btn-primary px-4">
                                    Next <i class="bi bi-arrow-right-circle"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    $(document).ready(function () {
        // Load Departments when Organization changes
        $("#OrganizationId").change(function () {
            var orgId = $(this).val();
            $("#DepartmentId").html('<option>Loading...</option>');
            $.getJSON('@Url.Action("GetDepartments")', { organizationId: orgId }, function (data) {
                var options = '<option>-- Select Department --</option>';
                $.each(data, function (i, dept) {
                    options += '<option value="' + dept.DepartmentId + '">' + dept.Name + '</option>';
                });
                $("#DepartmentId").html(options);
                $("#DoctorId").html('<option>-- Select Doctor --</option>');
            });
        });

        // Load Doctors when Department changes
        $("#DepartmentId").change(function () {
            var deptId = $(this).val();
            $("#DoctorId").html('<option>Loading...</option>');
            $.getJSON('@Url.Action("GetDoctors")', { departmentId: deptId }, function (data) {
                var options = '<option>-- Select Doctor --</option>';
                $.each(data, function (i, doc) {
                    options += '<option value="' + doc.DoctorId + '">' + doc.Name + '</option>';
                });
                $("#DoctorId").html(options);
            });
        });

        // Load Doctor Details when Doctor changes
        $("#DoctorId").change(function () {
            var docId = $(this).val();
            if (docId && docId !== "-- Select Doctor --") {
                $.getJSON('@Url.Action("GetDoctorDetails")', { doctorId: docId }, function (data) {
                    if (data) {
                        $("#docImage").attr("src", data.Picture || "~/Uploads/Doctors/doctor.png");
                        $("#docName").text(data.Name);
                        $("#docSpec").text(data.Specialization);
                        $("#docFee").text(data.Fee);
                        $("#docEmail").text(data.Email);
                        $("#docPhone").text(data.Phone);
                        $("#doctorDetails").show();
                    }
                });
            } else {
                $("#doctorDetails").hide();
            }
        });
    });
    </script>
}
